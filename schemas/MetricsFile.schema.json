{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "./MetricsFile.schema.json",
  "title": "MetricsFile",
  "description": "JSON import/export for metrics",
  "examples": [
    {
      "format": "THEYDO_METRICS_V1",
      "metrics": [
        {
          "importKey": "Id-1234",
          "title": "Some metric",
          "type": "CES",
          "unit": "%",
          "dataPoints": [
            {
              "dateOfMeasurement": "2020-01-31",
              "score": 15,
              "respondents": 100
            }
          ]
        }
      ]
    }
  ],
  "type": "object",
  "properties": {
    "format": {
      "type": "string",
      "const": "THEYDO_METRICS_V1"
    },
    "metrics": {
      "title": "Metrics",
      "type": "array",
      "items": {
        "title": "Metric",
        "oneOf": [
          {
            "$ref": "#/$defs/MetricCES"
          },
          {
            "$ref": "#/$defs/MetricCSAT"
          },
          {
            "$ref": "#/$defs/MetricNPS"
          },
          {
            "$ref": "#/$defs/MetricOTHER"
          },
          {
            "$ref": "#/$defs/MetricRATIO"
          }
        ]
      }
    }
  },
  "required": [
    "format",
    "metrics"
  ],
  "additionalProperties": false,
  "$defs": {
    "MetricCES": {
      "title": "MetricCES",
      "description": "Metric that contains CES datapoints",
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "const": "CES"
        },
        "importKey": {
          "description": "Unique identifier for metric",
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "description": {
          "description": "Description as Markdown",
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ]
        },
        "unit": {
          "type": "string"
        },
        "ownerEmail": {
          "oneOf": [
            {
              "type": "string",
              "format": "email",
              "pattern": "^(?!\\.)(?!.*\\.\\.)([A-Za-z0-9_'+\\-\\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\\-]*\\.)+[A-Za-z]{2,}$"
            },
            {
              "type": "null"
            }
          ]
        },
        "targetComparisonOperator": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "LESS_THAN_OR_EQUAL_TO",
                "MORE_THAN_OR_EQUAL_TO"
              ]
            },
            {
              "type": "null"
            }
          ]
        },
        "target": {
          "oneOf": [
            {
              "type": "number"
            },
            {
              "type": "null"
            }
          ]
        },
        "groups": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            {
              "type": "null"
            }
          ]
        },
        "groupTags": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "tagGroup": {
                    "type": "string"
                  },
                  "tag": {
                    "type": "string"
                  }
                },
                "required": [
                  "tagGroup",
                  "tag"
                ],
                "additionalProperties": false
              }
            },
            {
              "type": "null"
            }
          ]
        },
        "dataPoints": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/DataPointCES"
          }
        }
      },
      "required": [
        "type",
        "importKey",
        "title",
        "unit",
        "dataPoints"
      ],
      "additionalProperties": false
    },
    "MetricCSAT": {
      "title": "MetricCSAT",
      "description": "Metric that contains CSAT datapoints",
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "const": "CSAT"
        },
        "importKey": {
          "description": "Unique identifier for metric",
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "description": {
          "description": "Description as Markdown",
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ]
        },
        "unit": {
          "type": "string"
        },
        "ownerEmail": {
          "oneOf": [
            {
              "type": "string",
              "format": "email",
              "pattern": "^(?!\\.)(?!.*\\.\\.)([A-Za-z0-9_'+\\-\\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\\-]*\\.)+[A-Za-z]{2,}$"
            },
            {
              "type": "null"
            }
          ]
        },
        "targetComparisonOperator": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "LESS_THAN_OR_EQUAL_TO",
                "MORE_THAN_OR_EQUAL_TO"
              ]
            },
            {
              "type": "null"
            }
          ]
        },
        "target": {
          "oneOf": [
            {
              "type": "number"
            },
            {
              "type": "null"
            }
          ]
        },
        "groups": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            {
              "type": "null"
            }
          ]
        },
        "groupTags": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "tagGroup": {
                    "type": "string"
                  },
                  "tag": {
                    "type": "string"
                  }
                },
                "required": [
                  "tagGroup",
                  "tag"
                ],
                "additionalProperties": false
              }
            },
            {
              "type": "null"
            }
          ]
        },
        "dataPoints": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/DataPointCSAT"
          }
        }
      },
      "required": [
        "type",
        "importKey",
        "title",
        "unit",
        "dataPoints"
      ],
      "additionalProperties": false
    },
    "MetricNPS": {
      "title": "MetricNPS",
      "description": "Metric that contains NPS datapoints",
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "const": "NPS"
        },
        "importKey": {
          "description": "Unique identifier for metric",
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "description": {
          "description": "Description as Markdown",
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ]
        },
        "unit": {
          "type": "string"
        },
        "ownerEmail": {
          "oneOf": [
            {
              "type": "string",
              "format": "email",
              "pattern": "^(?!\\.)(?!.*\\.\\.)([A-Za-z0-9_'+\\-\\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\\-]*\\.)+[A-Za-z]{2,}$"
            },
            {
              "type": "null"
            }
          ]
        },
        "targetComparisonOperator": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "LESS_THAN_OR_EQUAL_TO",
                "MORE_THAN_OR_EQUAL_TO"
              ]
            },
            {
              "type": "null"
            }
          ]
        },
        "target": {
          "oneOf": [
            {
              "type": "number"
            },
            {
              "type": "null"
            }
          ]
        },
        "groups": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            {
              "type": "null"
            }
          ]
        },
        "groupTags": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "tagGroup": {
                    "type": "string"
                  },
                  "tag": {
                    "type": "string"
                  }
                },
                "required": [
                  "tagGroup",
                  "tag"
                ],
                "additionalProperties": false
              }
            },
            {
              "type": "null"
            }
          ]
        },
        "dataPoints": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/DataPointNPS"
          }
        }
      },
      "required": [
        "type",
        "importKey",
        "title",
        "unit",
        "dataPoints"
      ],
      "additionalProperties": false
    },
    "MetricOTHER": {
      "title": "MetricOTHER",
      "description": "Metric that contains OTHER datapoints",
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "const": "OTHER"
        },
        "importKey": {
          "description": "Unique identifier for metric",
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "description": {
          "description": "Description as Markdown",
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ]
        },
        "unit": {
          "type": "string"
        },
        "ownerEmail": {
          "oneOf": [
            {
              "type": "string",
              "format": "email",
              "pattern": "^(?!\\.)(?!.*\\.\\.)([A-Za-z0-9_'+\\-\\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\\-]*\\.)+[A-Za-z]{2,}$"
            },
            {
              "type": "null"
            }
          ]
        },
        "targetComparisonOperator": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "LESS_THAN_OR_EQUAL_TO",
                "MORE_THAN_OR_EQUAL_TO"
              ]
            },
            {
              "type": "null"
            }
          ]
        },
        "target": {
          "oneOf": [
            {
              "type": "number"
            },
            {
              "type": "null"
            }
          ]
        },
        "groups": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            {
              "type": "null"
            }
          ]
        },
        "groupTags": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "tagGroup": {
                    "type": "string"
                  },
                  "tag": {
                    "type": "string"
                  }
                },
                "required": [
                  "tagGroup",
                  "tag"
                ],
                "additionalProperties": false
              }
            },
            {
              "type": "null"
            }
          ]
        },
        "dataPoints": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/DataPointOTHER"
          }
        },
        "aggregationMethod": {
          "title": "AggregationMethod",
          "description": "Method to use to aggregate values",
          "type": "string",
          "enum": [
            "SUM",
            "AVERAGE"
          ]
        }
      },
      "required": [
        "type",
        "importKey",
        "title",
        "unit",
        "dataPoints",
        "aggregationMethod"
      ],
      "additionalProperties": false
    },
    "MetricRATIO": {
      "title": "MetricRATIO",
      "description": "Metric that contains RATIO datapoints",
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "const": "RATIO"
        },
        "importKey": {
          "description": "Unique identifier for metric",
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "description": {
          "description": "Description as Markdown",
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ]
        },
        "unit": {
          "type": "string"
        },
        "ownerEmail": {
          "oneOf": [
            {
              "type": "string",
              "format": "email",
              "pattern": "^(?!\\.)(?!.*\\.\\.)([A-Za-z0-9_'+\\-\\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\\-]*\\.)+[A-Za-z]{2,}$"
            },
            {
              "type": "null"
            }
          ]
        },
        "targetComparisonOperator": {
          "oneOf": [
            {
              "type": "string",
              "enum": [
                "LESS_THAN_OR_EQUAL_TO",
                "MORE_THAN_OR_EQUAL_TO"
              ]
            },
            {
              "type": "null"
            }
          ]
        },
        "target": {
          "oneOf": [
            {
              "type": "number"
            },
            {
              "type": "null"
            }
          ]
        },
        "groups": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            {
              "type": "null"
            }
          ]
        },
        "groupTags": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "tagGroup": {
                    "type": "string"
                  },
                  "tag": {
                    "type": "string"
                  }
                },
                "required": [
                  "tagGroup",
                  "tag"
                ],
                "additionalProperties": false
              }
            },
            {
              "type": "null"
            }
          ]
        },
        "dataPoints": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/DataPointRATIO"
          }
        }
      },
      "required": [
        "type",
        "importKey",
        "title",
        "unit",
        "dataPoints"
      ],
      "additionalProperties": false
    },
    "DataPointCES": {
      "title": "DataPointCES",
      "description": "CES data point",
      "type": "object",
      "properties": {
        "dateOfMeasurement": {
          "$ref": "#/$defs/ISODate"
        },
        "dimensions": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Dimension"
          }
        },
        "score": {
          "$ref": "#/$defs/Value"
        },
        "respondents": {
          "$ref": "#/$defs/Count"
        }
      },
      "required": [
        "dateOfMeasurement",
        "score",
        "respondents"
      ],
      "additionalProperties": false
    },
    "DataPointCSAT": {
      "title": "DataPointCSAT",
      "description": "CSAT data point",
      "type": "object",
      "properties": {
        "dateOfMeasurement": {
          "$ref": "#/$defs/ISODate"
        },
        "dimensions": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Dimension"
          }
        },
        "neutral": {
          "$ref": "#/$defs/Count"
        },
        "satisfied": {
          "$ref": "#/$defs/Count"
        },
        "unsatisfied": {
          "$ref": "#/$defs/Count"
        },
        "verySatisfied": {
          "$ref": "#/$defs/Count"
        },
        "veryUnsatisfied": {
          "$ref": "#/$defs/Count"
        }
      },
      "required": [
        "dateOfMeasurement",
        "neutral",
        "satisfied",
        "unsatisfied",
        "verySatisfied",
        "veryUnsatisfied"
      ],
      "additionalProperties": false
    },
    "DataPointNPS": {
      "title": "DataPointNPS",
      "description": "NPS data point",
      "type": "object",
      "properties": {
        "dateOfMeasurement": {
          "$ref": "#/$defs/ISODate"
        },
        "dimensions": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Dimension"
          }
        },
        "detractors": {
          "$ref": "#/$defs/Count"
        },
        "passives": {
          "$ref": "#/$defs/Count"
        },
        "promoters": {
          "$ref": "#/$defs/Count"
        }
      },
      "required": [
        "dateOfMeasurement",
        "detractors",
        "passives",
        "promoters"
      ],
      "additionalProperties": false
    },
    "DataPointOTHER": {
      "title": "DataPointOTHER",
      "description": "OTHER data point",
      "type": "object",
      "properties": {
        "dateOfMeasurement": {
          "$ref": "#/$defs/ISODate"
        },
        "dimensions": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Dimension"
          }
        },
        "value": {
          "$ref": "#/$defs/Value"
        }
      },
      "required": [
        "dateOfMeasurement",
        "value"
      ],
      "additionalProperties": false
    },
    "DataPointRATIO": {
      "title": "DataPointRATIO",
      "description": "RATIO data point",
      "type": "object",
      "properties": {
        "dateOfMeasurement": {
          "$ref": "#/$defs/ISODate"
        },
        "dimensions": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Dimension"
          }
        },
        "numerator": {
          "type": "number"
        },
        "denominator": {
          "type": "number"
        }
      },
      "required": [
        "dateOfMeasurement",
        "numerator",
        "denominator"
      ],
      "additionalProperties": false
    },
    "ISODate": {
      "title": "ISODate",
      "description": "Date in YYYY-MM-DD format",
      "type": "string",
      "format": "date",
      "pattern": "^(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))$"
    },
    "Value": {
      "title": "Value",
      "description": "Float",
      "type": "number"
    },
    "Count": {
      "title": "Count",
      "description": "Non-negative integer",
      "type": "integer",
      "minimum": 0,
      "maximum": 9007199254740991
    },
    "Dimension": {
      "title": "Dimension",
      "description": "Value for one dimension",
      "type": "object",
      "properties": {
        "key": {
          "type": "string"
        },
        "value": {
          "type": "string"
        }
      },
      "required": [
        "key",
        "value"
      ],
      "additionalProperties": false
    }
  }
}